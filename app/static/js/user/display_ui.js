$(function(){function e(e,i){getSearchData({params:e,done:function(e){var r=e.filters;a=genUrlQuery({filterSelected:r.selected,otherParams:e.items}),$("#amount").text(e.items.amount),o.setItems(e.items.query),s.updateFilterValue(filterValuesMapping(r.available)),n=d(e.items.pages,e.items.page),!i&&t.addHistory(a,"?"+$.param(a,!0)),i&&s.setFilterState(filterValuesMapping(r.selected))},fail:function(){}})}var t,a=null,i=(React.render(React.createElement(ProgressBar,null),$("#progress-bar")[0]),[{name:"材料",field:"material",canMultiSelect:!0},{name:"风格",field:"style",canMultiSelect:!0},{name:"场景",field:"scene",canMultiSelect:!0},{name:"种类",field:"category",canMultiSelect:!0},{name:"品牌",field:"brand",canMultiSelect:!0},{name:"价格",field:"price"}]),r=[],l=function(t){console.log("state change:",t),e(genUrlQuery({filterSelected:t,otherParams:a,isFromFilter:!0}))},s=React.render(React.createElement(FilterGroup,{filterDefs:i,filterValues:r,onStateChange:l},React.createElement("span",null,"所有分类 > 共 ",React.createElement("span",{id:"amount"},"0")," 个商品")),$("#filter-group")[0]);t=new HistoryWatcher(function(t){console.log("history changed:",t.state),e(t.state,s,!0)}),$(".sortbar .sort").delegate(".sort-index","click",function(){var e=$(this);return e.siblings().removeClass("active"),e.hasClass("active")&&"hot"!=e.attr("data-sort")&&e.children(".darr").toggleClass("reverse"),e.addClass("active"),!1});var n,c=React.createClass({displayName:"Item",render:function(){({display:this.props.item.deleted?"block":"none"});return React.createElement("div",{className:"item","data-id":this.props.item.item_id},React.createElement("a",{href:"/item/"+this.props.item.item_id},React.createElement("img",{src:this.props.item.image_url,alt:this.props.item.item})),React.createElement("div",{className:"item-info"},React.createElement("h5",null,React.createElement("a",{href:"/item/"+this.props.item.item_id},this.props.item.item)),React.createElement("div",{className:"price"},"¥ ",this.props.item.price)))}}),m=React.createClass({displayName:"Items",getInitialState:function(){return{filteredItems:[]}},setItems:function(e){this.setState({filteredItems:e})},render:function(){return React.createElement("div",{className:"item-wrapper clearfix"},this.state.filteredItems.map(function(e,t){return React.createElement(c,{item:e,key:t})}))}}),o=React.render(React.createElement(m,null),$("#items")[0]),u=function(t){e($.extend({},a,{page:t}),s,!0)},d=function(e,t){return React.render(React.createElement(Pagination,{pages:e,activePage:t||1,selected:u,theme:"dark",quickGo:!0}),$("#paging")[0])};!function(){getSearchData({done:function(e){a=genUrlQuery({filterSelected:e.filters.selected,otherParams:e.items}),$("#amount").text(e.items.amount),o.setItems(e.items.query),s.updateFilterValue(filterValuesMapping(e.filters.available)),s.setFilterState(filterValuesMapping(e.filters.selected)),n=d(e.items.pages,e.items.page)},fail:function(){}})}()});