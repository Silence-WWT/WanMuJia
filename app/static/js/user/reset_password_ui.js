function btnLoading(e){e.attr("disabled",!0),e.val("Loading...")}function btnClearLoading(e,t){e.attr("disabled",!1),e.val(t)}function sendEnable(e,t){e.val(t),e.removeClass("disabled")}function sendDisable(e,t,n){var a=parseInt((n-t+parseInt(getCookie("clickTime")))/1e3);e.addClass("disabled"),e.val(a+" 秒后再次发送")}function setCountDown(e,t,n){var a=setInterval(function(){Date.now()-getCookie("clickTime")>=n-1e3?(clearTimeout(a),sendEnable(e,t),setCookie("clickTime","",new Date(0))):sendDisable(e,Date.now(),n)},200)}function isMobilePhone(e){var t=/^1\d{10}$/;return t.exec(e)?!0:!1}function isEmail(e){var t=/^([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+@([a-zA-Z0-9]+[_|\_|\.]?)*[a-zA-Z0-9]+\.[a-zA-Z]{2,3}$/;return t.test(e)?!0:!1}$(function(){function e(){var e=r.val();return 0===e.length?(f.fadeIn("100").text("请输入手机号码"),!1):isMobilePhone(e)?(f.text(" ").fadeOut("50"),!0):(f.fadeIn("100").text("请输入正确的手机号码"),!1)}function t(){var e=l.val();return 0===e.length?(d.fadeIn("100").text("请输入验证码"),!1):(d.text(" ").fadeOut("50"),!0)}function n(){var e=c.val();return 0===e.length?(v.fadeIn("100").text("请输入邮箱"),!1):isEmail(e)?(v.text(" ").fadeOut("50"),!0):(v.fadeIn("100").text("请输入正确的邮箱地址"),!1)}var a="/reset_password_next",i="/service/mobile_sms?type=USER_RESET_PASSWORD",s="/reset_password",o="/service/send_email?type=USER_RESET_PASSWORD",r=$("#mp"),l=$("#verify"),c=$("#email"),u=$("#csrf_token"),f=$(".err-tip.mp"),d=$(".err-tip.ver"),v=$(".err-tip.email"),b=$(".send"),m=$("#next"),g=$("#sendEmail"),p=6e4,h=b.val();getCookie("clickTime")&&(sendDisable(b,Date.now(),p),setCountDown(b,h,p)),$(".another-way").click(function(e){$this=$(this),$this.parents('[class|="way"]').hide(),$(".way-"+$this.data("way")).show(),e.preventDefault()}),r.blur(function(){e()}),b.click(function(){if(e()){var t=$(this);t.hasClass("disabled")||$.ajax({type:"POST",url:i,data:{mobile:r.val(),csrf_token:u.val()},success:function(e){e.success?(setCookie("clickTime",Date.now()),setCountDown(t,h,p)):f.fadeIn("100").text(e.message)},error:function(e,t,n){console.error(i,t,n.toString())}})}}),l.blur(function(){t()}),m.click(function(n){if(n.preventDefault(),!e())return!1;if(!t())return!1;var i=$(this),o=i.val();btnLoading(i),$.ajax({type:"POST",url:s,data:{mobile:r.val(),captcha:l.val(),csrf_token:u.val()},success:function(e){btnClearLoading(i,o),e.success?window.location.href=a:f.fadeIn("100").text(e.message)},error:function(e,t,n){console.error(s,t,n.toString())}})}),c.blur(function(){n()}),g.click(function(e){if(e.preventDefault(),n()){var t=$(this),a=t.val();btnLoading(t),$.ajax({type:"POST",url:o,data:{email:c.val(),csrf_token:u.val()},success:function(e){btnClearLoading(t,a),v.fadeIn("100").text(e.success?"重置密码邮件已发到您的邮箱":e.message)},error:function(e,t,n){console.error(o,t,n.toString())}})}})});