function init(){var e=window.location.hash.slice(1)?window.location.hash.slice(1):"collections";$(".tabs").children("[data-tab="+e+"]").addClass("active"),$(".tab-content").children("."+e).removeClass("hide"),$(".collections").delegate(".dialog","click",function(e){e.preventDefault()}),$(".collections").on("click",".del",function(e){var t=$(this).parent().find(".dialog");t.addClass("dialog-confirm").css("display","block"),e.preventDefault()}),$(".collections").on("click",".cancle",function(){var e=$(this).parents(".dialog");e.removeClass("dialog-confirm").hide()}),$(".collections").on("click",".confirm",function(){var e=$(this).parents(".item"),t=e.data("id");$.ajax({url:"/collection",type:"DELETE",data:{item:t},success:function(){e.remove()}})})}function settingInit(){$(".verified").on("input",function(){var e,t=$(this).val();e="nickname"===$(this).attr("name")?checkInfo(t,"nickname"):"password"===$(this).attr("type")?checkInfo(t,"userPassword"):"phone"===$(this).attr("name")?checkInfo(t,"mobile"):"verify"===$(this).attr("name")?checkInfo(t,"captcha"):"email"===$(this).attr("name")?checkInfo(t,"email"):"",setFormTip(this,e)}),$("#settingSubmit").click(function(e){e.preventDefault();var t=$("#nickname").val(),i=$(this).parent().prev().text();t?i||$.post("/settings",{nickname:t,csrf_token:$("#csrf_token").val()},function(e){e.success?(setFormTip(this,"修改成功",!0),alert("修改成功"),window.location.reload()):setFormTip(this,e.message)}.bind(this)):setFormTip(this,"昵称不能为空")}),$("#pwdSubmit").click(function(e){e.preventDefault();var t=$("#oriPwd").val(),i=$("#newPwd").val(),s=$("#conPwd").val(),n=$(this).parent().prev().text();t&&i&&s?i!==s?setFormTip(this,"两次密码输入不同"):n||$.post("/change_password",{old_password:encrypt(encrypt(t)),new_password:encrypt(encrypt(i)),confirm_password:encrypt(encrypt(s)),csrf_token:$("#csrf_token").val()},function(e){e.success?(setFormTip(this,"修改成功",!0),alert("修改成功")):setFormTip(this,e.message)}.bind(this)):setFormTip(this,"密码不能为空")}),$(".send-verify").click(function(e){e.preventDefault();var t=$("#newmobile").val(),i=checkInfo(t,"mobile");t?i?setFormTip(this,i):i||$.post("/service/mobile_register_sms",{mobile:t,csrf_token:$("#csrf_token").val()},function(e){e.success?setFormTip(this,"验证码已发送",!0):setFormTip(this,e.message)}.bind(this)):setFormTip(this,"密码不能为空")}),$("#phoneSubmit").click(function(e){e.preventDefault();var t=$("#newmobile").val(),i=$("#newverify").val(),s=$(this).parent().prev().text();t?i?s||$.post("/settings",{mobile:t,captcha:i,csrf_token:$("#csrf_token").val()},function(e){e.success?(setFormTip(this,"绑定成功",!0),alert("绑定成功"),window.location.reload()):setFormTip(this,e.message)}.bind(this)):setFormTip(this,"验证码不能为空"):setFormTip(this,"手机号码不能为空")}),$("#emailSubmit").click(function(e){e.preventDefault();var t=$("#newemail").val(),i=$(this).parent().prev().text();t?i||$.post("/service/send_email?type=USER_EMAIL_CONFIRM",{role:"user",email:t,csrf_token:$("#csrf_token").val()},function(e){e.success?setFormTip(this,"请前往邮箱确认绑定",!0):setFormTip(this,e.message)}.bind(this)):setFormTip(this,"邮箱不能为空")})}function getItems(e,t){e=e||1,$.get("/collection",{page:e},t)}function setFormTip(e,t,i){var s=$(e).parents("form").children(".form-tip");s.text(t),i?s.addClass("success"):s.removeClass("success")}function checkInfo(e,t){var i=getRegs(),s={mobile:"手机号码格式不正确，请重新输入",email:"邮箱格式不正确，请重新输入",userPassword:"密码为6-16位的数字、字母或_.的组合",captcha:"验证码格式不正确",nickname:"昵称必须为4-30位的中文、字母和数字组合，且不能全是数字"};return i[t].test(e)?"":s[t]}var Item=React.createClass({displayName:"Item",render:function(){var e={display:this.props.item.deleted?"block":"none"};return React.createElement("div",{className:"item","data-id":this.props.item.item_id},React.createElement("a",{href:"/item/"+this.props.item.item_id},React.createElement("img",{src:this.props.item.image_url,alt:this.props.item.item}),React.createElement("span",{className:"del glyphicon glyphicon-trash"}),React.createElement("div",{className:"dialog",style:e},React.createElement("div",{className:"info"},React.createElement("p",null,"确定删除吗？"),React.createElement("div",{className:"btn-group"},React.createElement("button",{className:"confirm"},"确认"),React.createElement("button",{className:"cancle"},"取消"))))),React.createElement("div",{className:"item-info"},React.createElement("h5",null,React.createElement("a",{href:"/item/"+this.props.item.item_id},this.props.item.item)),React.createElement("div",{className:"price"},"¥ ",this.props.item.price)))}}),Items=React.createClass({displayName:"Items",getInitialState:function(){return{collections:[]}},setCollection:function(e){this.setState({collections:e})},render:function(){return React.createElement("div",{className:"item-wrapper clearfix"},this.state.collections.map(function(e,t){return React.createElement(Item,{item:e,key:t})}))}});$(function(){init(),settingInit();var e=1,t=React.render(React.createElement(Items,null),$(".collections").children(".main")[0]),i=function(e){getItems(e,function(e){t.setCollection(e.collections)})};getItems(e,function(e){t.setCollection(e.collections),console.log(e),React.render(React.createElement(Pagination,{pages:e.pages,first:"首页",last:"末页",theme:"dark",selected:i}),$(".collections").children(".pagi")[0])})});