function setCookie(e,a,t){var n=encodeURIComponent(e)+"="+encodeURIComponent(a);return t instanceof Date&&(n+="; expires="+t.toGMTString()),document.cookie=n}function getCookie(e){var a;return decodeURIComponent(document.cookie).split("; ").forEach(function(t){t=t.split("="),e===t[0]&&(a=t[1])}),a}function convertTimeString(e){if("number"!=typeof e)return"";var a=new Date(1e3*e);return a.getFullYear()+"-"+a.getMonth()+"-"+a.getDay()}function getPageTitle(){return $(".page-title").data("page")}function saveInfos(e){$.ajax({url:e.url,method:e.method,data:e.form.serialize(),success:e.success,error:e.error})}function deleteImage(e){$.ajax({url:"/vendor/item_image",method:"put",data:{image_hash:e}})}function formDirtyCheck(e,a){var t=e.serialize(),n=t!==a;return{isDirty:n,origin:n?t:a}}function genImageView(e){return'<div class="col-md-3 col-sm-4 col-xs-6"><div class="album-image" data-hash="'+e.hash+'"><a href="#" class="thumb" data-action="edit" data-toggle="modal" data-target="#gallery-image-modal"><img src="'+e.url+'" class="img-responsive" /></a><a href="#" class="name"><span>'+e.name+"</span><em>"+convertTimeString(e.created)+'</em></a><div class="image-options"><a href="#" data-action="trash" data-toggle="modal" data-target="#gallery-image-delete-modal"><i class="fa-trash"></i></a></div></div></div>'}function setElemText(e,a){e.is("input")?e.val(a):e.text(a)}function sendEnable(e,a){setElemText(e,a),e.removeClass("disabled")}function sendDisable(e,a,t){var n=parseInt((t-a+parseInt(getCookie("clickTime")))/1e3);e.addClass("disabled"),setElemText(e,n+" 秒后点击再次发送")}function setCountDown(e,a,t){var n=setInterval(function(){Date.now()-getCookie("clickTime")>=t-1e3?(clearTimeout(n),sendEnable(e,a),setCookie("clickTime","",new Date(0))):sendDisable(e,Date.now(),t)},200)}function setFormDisabled(e){e.find(".form-control").attr("disabled",!0)}jQuery(document).ready(function(e){function a(e,a){e.dataTable({aLengthMenu:[[10,25,50,100,-1],[10,25,50,100,"All"]],language:{sProcessing:"处理中...",sLengthMenu:"显示 _MENU_ 项结果",sZeroRecords:"没有匹配结果",sInfo:"显示第 _START_ 至 _END_ 项结果，共 _TOTAL_ 项",sInfoEmpty:"显示第 0 至 0 项结果，共 0 项",sInfoFiltered:"(由 _MAX_ 项结果过滤)",sInfoPostFix:"",sSearch:"搜索:",sUrl:"",sEmptyTable:"表中数据为空",sLoadingRecords:"载入中...",sInfoThousands:",",oPaginate:{sFirst:"首页",sPrevious:"上页",sNext:"下页",sLast:"末页"},oAria:{sSortAscending:": 以升序排列此列",sSortDescending:": 以降序排列此列"}},processing:!0,serverSide:!0,ajax:a.ajax,columns:a.columns,columnDefs:a.columnDefs})}"items"===getPageTitle()&&(a(e("#items"),{ajax:"/distributor/items/datatable",columns:[{data:"id",visible:!1},{data:"item",bSortable:!1},{data:"second_category_id",bSortable:!1},{data:"price"},{data:"size",bSortable:!1},{data:"inventory",visible:!1}],columnDefs:[{targets:[6],data:{},render:function(e){var a=null,t=null;return 1===e.inventory?(a="有货",t="checked"):(a="无货",t=""),'<label class="inventory-info">'+a+'</label><input type="checkbox" '+t+' class="inventory-checkbox iswitch iswitch-secondary" data-id="'+e.id+'"><div class="disable-div"></div>'}}]}),e("#items").delegate(".inventory-checkbox","click",function(){function a(){var e=n.prev(".inventory-info");e.text(n.is(":checked")?"有货":"无货"),n.prop("disabled",!1),r.find(".loading").remove()}function t(){n.is(":checked")?n.prop("checked",!1):n.prop("checked",!0)}var n=e(this);if(!n.hasClass("disabled")){var i=e('<span class="loading fa fa-spin fa-spinner"></span>'),o=e('<span class="error-hint text-danger">服务器错误请重试</span>'),s=n.data("id"),r=n.parent();n.prop("disabled",!0),r.append(i),e.ajax({url:"/distributor/items/"+s,method:"post",data:s,success:function(){a(),r.find(".error-hint").remove()},error:function(){t(),a(),0===r.find(".error-hint").length&&r.append(o)}})}})),"settings"===getPageTitle()&&(e("#contact_mobile").rules("add",{mobile:!0,messages:{mobile:"请填写合法的手机号码"}}),e("#contact_telephone").rules("add",{tel:!0,messages:{tel:"请填写合法的固定电话号码"}})),e.validator&&(e.validator.addMethod("mobile",function(e,a){var t=e.length,n=/^((1[3-8][0-9])+\d{8})$/;return this.optional(a)||11==t&&n.test(e)}),e.validator.addMethod("tel",function(e,a){var t=/^\d{3,4}-?\d{7,9}$/;return this.optional(a)||t.test(e)}));var t=e("#img-upload.dropzone");t.length>0&&t.dropzone({url:"/vendor/item_image",method:"put",acceptedFiles:"image/jpg, image/jpeg, image/png",addRemoveLinks:"item-edit"!==getPageTitle(),dictDefaultMessage:"拖动文件到此以上传",dictResponseError:"服务器错误, 上传失败, 请稍后重试。",dictCancelUpload:"取消上传",dictCancelUploadConfirmation:"确定取消上传吗？",dictRemoveFile:"移除文件",init:function(){this.on("removedfile",function(a){console.log(a.previewElement);var t=e(a.previewElement).data("hash");t&&deleteImage(t)}).on("success",function(a,t){e(a.previewElement).data("hash",t.hash);var n=e(".album-images");n.length>0&&n.append(e(genImageView({name:a.name,hash:t.hash,url:t.url,created:t.created})))})}})});